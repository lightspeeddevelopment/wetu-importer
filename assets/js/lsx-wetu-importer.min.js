var WETU_IMPORTER={data_table:!1,status_search:!1,init:function(){jQuery("body").hasClass("tour-operator_page_lsx-wetu-importer")&&(this.myAccommodationSearch(),this.watchSearch(),this.watchAdvancedSearch(),this.watchImportButton(),this.watchAddToListButton(),this.watchClearButton(),this.watchBannerButton(),this.watchConnectButton(),this.watchCheckBoxes(),this.watchTourUpdate())},myAccommodationSearch:function(){jQuery(".subsubsub li a").on("click",function(t){t.preventDefault(),jQuery(".subsubsub li a.current").removeClass("current"),jQuery(this).addClass("current");var e="";jQuery(this).parent().hasClass("publish")?e="publish":jQuery(this).parent().hasClass("pending")?e="pending":jQuery(this).parent().hasClass("draft")?e="draft":jQuery(this).parent().hasClass("import")&&(e="import"),WETU_IMPORTER.status_search=!0,jQuery("#lsx-wetu-importer-search-form").find("input.keyword").val(e),jQuery("#lsx-wetu-importer-search-form").submit(),jQuery("#lsx-wetu-importer-search-form").find("input.keyword").val("")})},watchSearch:function(){jQuery("#lsx-wetu-importer-search-form input.submit").on("click",function(t){jQuery(".subsubsub li a.current").removeClass("current"),jQuery(".subsubsub li.searchform a").addClass("current")}),jQuery("#lsx-wetu-importer-search-form").on("submit",function(t){t.preventDefault();var e=[[1,"asc"]];if(jQuery(".subsubsub li a.current").removeClass("current"),jQuery(".subsubsub li.searchform a").addClass("current"),console.log(WETU_IMPORTER.data_table),!1!==WETU_IMPORTER.data_table){console.log("preserve_import3");var r=jQuery("#import-list .wp-list-table").html();WETU_IMPORTER.data_table.destroy(),jQuery("#import-list .wp-list-table").html(r)}!1!==WETU_IMPORTER.status_search&&(e=[[2,"asc"]]);var a=jQuery("#posts-filter thead th").length;jQuery("#posts-filter tbody").html('<tr><td style="text-align:center;" colspan="'+(a-1)+'">'+jQuery("#lsx-wetu-importer-search-form .ajax-loader").html()+"</td></tr>");var o=jQuery("#lsx-wetu-importer-search-form").attr("data-type"),s=[];if(""!=jQuery("#lsx-wetu-importer-search-form input.keyword").val()&&s.push(jQuery("#lsx-wetu-importer-search-form input.keyword").val()),void 0!=jQuery("#lsx-wetu-importer-search-form .advanced-search textarea").val())for(var n=jQuery("#lsx-wetu-importer-search-form .advanced-search textarea").val().split("\n"),u=n.length,i=0;i<u;i++)s.push(n[i]);return jQuery.post(lsx_tour_importer_params.ajax_url,{action:"lsx_tour_importer",type:o,keyword:s,security:lsx_tour_importer_params.ajax_nonce},function(t){jQuery("#posts-filter tbody").html(t)}).done(function(){WETU_IMPORTER.data_table=jQuery("#posts-filter .wp-list-table").DataTable({searching:!1,dom:'<"top"ip<"clear">>rt<"bottom"lp<"clear">>',order:e,columnDefs:[{targets:0,orderable:!1},{targets:1,visible:!1,searchable:!1}],destroy:!0}),WETU_IMPORTER.status_search=!1}),!1})},watchAdvancedSearch:function(){jQuery("#lsx-wetu-importer-search-form .advanced-search-toggle").on("click",function(t){t.preventDefault(),jQuery("#lsx-wetu-importer-search-form .advanced-search").hasClass("hidden")?(jQuery("#lsx-wetu-importer-search-form .advanced-search").fadeIn("fast").css("display","inline-block").removeClass("hidden"),jQuery("#lsx-wetu-importer-search-form .normal-search").hide("fast"),jQuery("#lsx-wetu-importer-search-form .normal-search input.keyword").val(""),jQuery(this).html("Simple Search")):(jQuery("#lsx-wetu-importer-search-form .advanced-search").fadeOut("fast").addClass("hidden"),jQuery("#lsx-wetu-importer-search-form .advanced-search textarea").val(""),jQuery("#lsx-wetu-importer-search-form .normal-search").fadeIn("fast"),jQuery(this).html("Bulk Search"))})},watchClearButton:function(){jQuery("#posts-filter input.button.clear").on("click",function(t){t.preventDefault(),jQuery("#posts-filter tbody").html(""),jQuery('#lsx-wetu-importer-search-form input[type="text"]').val("")})},watchAddToListButton:function(){jQuery("#posts-filter input.button.add").on("click",function(t){t.preventDefault(),jQuery(".import-list-wrapper").fadeIn("fast"),jQuery("#posts-filter tbody tr input:checked").each(function(){jQuery("#import-list tbody").append(jQuery(this).parent().parent())}),jQuery("#import-list tbody tr input:checked").each(function(){})})},importRow:function(t,e){var r=this,a=e;console.log(t),a.find("td.post-title strong").css("color","#555"),jQuery.ajax({url:lsx_tour_importer_params.ajax_url,data:t,method:"POST"}).always(function(t,e,a){r.importNext()}).done(function(t){"none"==jQuery(".completed-list-wrapper").css("display")&&jQuery(".completed-list-wrapper").fadeIn("fast"),jQuery(".completed-list-wrapper ul").append(t),a.fadeOut("fast",function(t){jQuery(this).fadeOut("fast").remove()}),console.log("done")}).fail(function(t){console.log(a.find(".check-column")),a.find(".post-title").css("color","red"),a.find(".check-column input").attr("checked",""),a.find(".check-column input").removeClass("importing"),a.find(".check-column input").removeClass("queued"),a.find(".check-column input").show(),a.find(".check-column img").remove()})},importNext:function(){var t=jQuery("#import-list tr input.queued:checked:not(.importing):first");if(1==t.length){t.addClass("importing");var e=(jQuery(".post_type").val(),jQuery("#lsx-wetu-importer-search-form").attr("data-type")),r=[];"undefined"!=jQuery("#import-list input.team").length&&jQuery("#import-list input.team").each(function(){!0===jQuery(this).prop("checked")&&r.push(jQuery(this).val())});var a=[];"undefined"!=jQuery("#import-list input.content").length&&jQuery("#import-list input.content").each(function(){!0===jQuery(this).prop("checked")&&a.push(jQuery(this).val())});var o=[];"undefined"!=jQuery("#import-list input.accommodation-brand").length&&jQuery("#import-list input.accommodation-brand").each(function(){!0===jQuery(this).prop("checked")&&o.push(jQuery(this).val())});var s=t.attr("data-identifier"),n=t.val(),u=t.parents("tr"),i={action:"lsx_import_items",type:e,wetu_id:s,post_id:n,team_members:r,safari_brands:o,content:a,security:lsx_tour_importer_params.ajax_nonce};this.importRow(i,u)}},watchImportButton:function(){var t=this;jQuery('#import-list input[type="submit"]').on("click",function(e){e.preventDefault(),counter=0;var r=!0;jQuery("#import-list tr input:checked:not(.queued)").each(function(){jQuery(this).hide().addClass("queued"),jQuery(this).parents("tr").find(".check-column").append(jQuery("#lsx-wetu-importer-search-form .ajax-loader-small").html()),r=!1}),1!=r?t.importNext():alert("Make sure you have some items selected.")})},watchBannerButton:function(){jQuery("#banners-filter input.button.download").on("click",function(t){t.preventDefault(),jQuery("#banners-filter tbody tr input:checked").each(function(){var t=jQuery(this).val(),e=jQuery(this).parents("tr");jQuery(this).hide(),jQuery(this).parents("tr").find(".check-column").append(jQuery("#banners-filter .ajax-loader-small").html()),jQuery.post(lsx_tour_importer_params.ajax_url,{action:"lsx_import_sync_banners",post_id:t,security:lsx_tour_importer_params.ajax_nonce},function(t){e.fadeOut("fast",function(t){jQuery(this).fadeOut("fast").remove()})})})})},watchConnectButton:function(){jQuery("#connect-accommodation-filter input.button.connect").on("click",function(t){t.preventDefault(),jQuery("#connect-accommodation-filter tbody tr input:checked").each(function(){var t=jQuery(this).val(),e=jQuery(this).attr("data-identifier"),r=jQuery(this).parents("tr");jQuery(this).hide(),jQuery(this).parents("tr").find(".check-column").append(jQuery("#connect-accommodation-filter .ajax-loader-small").html()),jQuery.post(lsx_tour_importer_params.ajax_url,{action:"lsx_import_connect_accommodation",post_id:t,type:"connect_accommodation",wetu_id:e,security:lsx_tour_importer_params.ajax_nonce},function(t){"none"==jQuery(".completed-list-wrapper").css("display")&&jQuery(".completed-list-wrapper").fadeIn("fast"),jQuery(".completed-list-wrapper ul").append(t),r.fadeOut("fast",function(t){jQuery(this).fadeOut("fast").remove()})})})})},watchCheckBoxes:function(){jQuery(".settings-all input").on("click",function(t){jQuery(this).trigger("change")})},watchTourUpdate:function(){jQuery(".wetu-status.tour-wetu-status h3 a").on("click",function(t){t.preventDefault(),jQuery(".wetu-status.tour-wetu-status").find("form").submit()})}};jQuery(document).ready(function(){WETU_IMPORTER.init(),$("#doc-tooltip").click(function(){$(".tooltip-inner").addClass("clicked")})});