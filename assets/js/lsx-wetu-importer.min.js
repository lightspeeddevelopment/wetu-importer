var WETU_IMPORTER={data_table:!1,init:function(){jQuery("body").hasClass("tour-operator_page_lsx-wetu-importer")&&(this.myAccommodationSearch(),this.watchSearch(),this.watchAdvancedSearch(),this.watchImportButton(),this.watchAddToListButton(),this.watchClearButton(),this.watchBannerButton(),this.watchConnectButton(),this.watchCheckBoxes(),this.watchTourUpdate())},myAccommodationSearch:function(){jQuery(".subsubsub li a").on("click",function(t){t.preventDefault(),jQuery(".subsubsub li a.current").removeClass("current"),jQuery(this).addClass("current");var e="";jQuery(this).parent().hasClass("publish")?e="publish":jQuery(this).parent().hasClass("pending")?e="pending":jQuery(this).parent().hasClass("draft")?e="draft":jQuery(this).parent().hasClass("import")&&(e="import"),jQuery("#lsx-wetu-importer-search-form").find("input.keyword").val(e),jQuery("#lsx-wetu-importer-search-form").submit(),jQuery("#lsx-wetu-importer-search-form").find("input.keyword").val("")})},watchSearch:function(){jQuery("#lsx-wetu-importer-search-form input.submit").on("click",function(t){jQuery(".subsubsub li a.current").removeClass("current"),jQuery(".subsubsub li.searchform a").addClass("current")}),jQuery("#lsx-wetu-importer-search-form").on("submit",function(t){t.preventDefault();jQuery(".subsubsub li a.current").removeClass("current"),jQuery(".subsubsub li.searchform a").addClass("current"),!1!==WETU_IMPORTER.data_table&&WETU_IMPORTER.data_table.destroy();var e=jQuery("#posts-filter thead th").length;jQuery("#posts-filter tbody").html('<tr><td style="text-align:center;" colspan="'+e+'">'+jQuery("#lsx-wetu-importer-search-form .ajax-loader").html()+"</td></tr>");var r=jQuery("#lsx-wetu-importer-search-form").attr("data-type"),a=[];if(""!=jQuery("#lsx-wetu-importer-search-form input.keyword").val()&&a.push(jQuery("#lsx-wetu-importer-search-form input.keyword").val()),void 0!=jQuery("#lsx-wetu-importer-search-form .advanced-search textarea").val())for(var o=jQuery("#lsx-wetu-importer-search-form .advanced-search textarea").val().split("\n"),n=o.length,s=0;s<n;s++)a.push(o[s]);return jQuery.post(lsx_tour_importer_params.ajax_url,{action:"lsx_tour_importer",type:r,keyword:a,security:lsx_tour_importer_params.ajax_nonce},function(t){jQuery("#posts-filter tbody").html(t)}).done(function(){WETU_IMPORTER.data_table=jQuery(".wp-list-table").DataTable({searching:!1,dom:'<"top"ip<"clear">>rt<"bottom"lp<"clear">>',order:[[1,"asc"]],columnDefs:[{orderable:!1,targets:0}]})}),!1})},watchAdvancedSearch:function(){jQuery("#lsx-wetu-importer-search-form .advanced-search-toggle").on("click",function(t){t.preventDefault(),jQuery("#lsx-wetu-importer-search-form .advanced-search").hasClass("hidden")?(jQuery("#lsx-wetu-importer-search-form .advanced-search").fadeIn("fast").css("display","inline-block").removeClass("hidden"),jQuery("#lsx-wetu-importer-search-form .normal-search").hide("fast"),jQuery("#lsx-wetu-importer-search-form .normal-search input.keyword").val(""),jQuery(this).html("Simple Search")):(jQuery("#lsx-wetu-importer-search-form .advanced-search").fadeOut("fast").addClass("hidden"),jQuery("#lsx-wetu-importer-search-form .advanced-search textarea").val(""),jQuery("#lsx-wetu-importer-search-form .normal-search").fadeIn("fast"),jQuery(this).html("Bulk Search"))})},watchClearButton:function(){jQuery("#posts-filter input.button.clear").on("click",function(t){t.preventDefault(),jQuery("#posts-filter tbody").html(""),jQuery('#lsx-wetu-importer-search-form input[type="text"]').val("")})},watchAddToListButton:function(){jQuery("#posts-filter input.button.add").on("click",function(t){t.preventDefault(),jQuery(".import-list-wrapper").fadeIn("fast"),!1!==WETU_IMPORTER.data_table&&(console.log("destroying5"),WETU_IMPORTER.data_table.destroy()),jQuery("#posts-filter tbody tr input:checked").each(function(){jQuery("#import-list tbody").append(jQuery(this).parent().parent())}),jQuery("#import-list tbody tr input:checked").each(function(){}),WETU_IMPORTER.data_table=jQuery(".wp-list-table").DataTable({searching:!1,dom:'<"top"ip<"clear">>rt<"bottom"lp<"clear">>',order:[[1,"asc"]],columnDefs:[{orderable:!1,targets:0}]})})},importRow:function(t,e){var r=this,a=e;a.find("td.post-title strong").css("color","#555"),jQuery.ajax({url:lsx_tour_importer_params.ajax_url,data:t,method:"POST"}).always(function(t,e,a){r.importNext()}).done(function(t){"none"==jQuery(".completed-list-wrapper").css("display")&&jQuery(".completed-list-wrapper").fadeIn("fast"),jQuery(".completed-list-wrapper ul").append(t),a.fadeOut("fast",function(t){jQuery(this).fadeOut("fast").remove()})}).fail(function(t){a.find("td.post-title strong").css("color","red"),a.find("td.check-column input").attr("checked","").show(),a.find("td.check-column img").remove()})},importNext:function(){var t=jQuery("#import-list tr input.queued:checked:not(.importing):first");if(1==t.length){t.addClass("importing");var e=(jQuery(".post_type").val(),jQuery("#lsx-wetu-importer-search-form").attr("data-type")),r=[];"undefined"!=jQuery("#import-list input.team").length&&jQuery("#import-list input.team").each(function(){jQuery(this).attr("checked")&&r.push(jQuery(this).val())});var a=[];"undefined"!=jQuery("#import-list input.content").length&&jQuery("#import-list input.content").each(function(){jQuery(this).attr("checked")&&a.push(jQuery(this).val())});var o=[];"undefined"!=jQuery("#import-list input.accommodation-brand").length&&jQuery("#import-list input.accommodation-brand").each(function(){jQuery(this).attr("checked")&&o.push(jQuery(this).val())});var n=t.attr("data-identifier"),s=t.val(),i=t.parents("tr"),u={action:"lsx_import_items",type:e,wetu_id:n,post_id:s,team_members:r,safari_brands:o,content:a,security:lsx_tour_importer_params.ajax_nonce};this.importRow(u,i)}},watchImportButton:function(){var t=this;jQuery('#import-list input[type="submit"]').on("click",function(e){e.preventDefault(),counter=0;var r=!0;jQuery("#import-list tr input:checked:not(.queued)").each(function(){jQuery(this).hide().addClass("queued"),jQuery(this).parents("tr").find(".check-column").append(jQuery("#lsx-wetu-importer-search-form .ajax-loader-small").html()),r=!1}),1!=r?t.importNext():alert("Make sure you have some items selected.")})},watchBannerButton:function(){jQuery("#banners-filter input.button.download").on("click",function(t){t.preventDefault(),jQuery("#banners-filter tbody tr input:checked").each(function(){var t=jQuery(this).val(),e=jQuery(this).parents("tr");jQuery(this).hide(),jQuery(this).parents("tr").find(".check-column").append(jQuery("#banners-filter .ajax-loader-small").html()),jQuery.post(lsx_tour_importer_params.ajax_url,{action:"lsx_import_sync_banners",post_id:t,security:lsx_tour_importer_params.ajax_nonce},function(t){e.fadeOut("fast",function(t){jQuery(this).fadeOut("fast").remove()})})})})},watchConnectButton:function(){jQuery("#connect-accommodation-filter input.button.connect").on("click",function(t){t.preventDefault(),jQuery("#connect-accommodation-filter tbody tr input:checked").each(function(){var t=jQuery(this).val(),e=jQuery(this).attr("data-identifier"),r=jQuery(this).parents("tr");jQuery(this).hide(),jQuery(this).parents("tr").find(".check-column").append(jQuery("#connect-accommodation-filter .ajax-loader-small").html()),jQuery.post(lsx_tour_importer_params.ajax_url,{action:"lsx_import_connect_accommodation",post_id:t,type:"connect_accommodation",wetu_id:e,security:lsx_tour_importer_params.ajax_nonce},function(t){"none"==jQuery(".completed-list-wrapper").css("display")&&jQuery(".completed-list-wrapper").fadeIn("fast"),jQuery(".completed-list-wrapper ul").append(t),r.fadeOut("fast",function(t){jQuery(this).fadeOut("fast").remove()})})})})},watchCheckBoxes:function(){jQuery('form#import-list .settings-all input[type="checkbox"]').on("change",function(t){var e=jQuery(this);"all"===e.val()&&e.parents("form").find('.settings-all input[type="checkbox"]:not([value="all"])').each(function(){"checked"===e.attr("checked")?jQuery(this).attr("checked","checked"):jQuery(this).removeAttr("checked")})});var t=null;jQuery('#the-list input[type="checkbox"], #import-list tbody input[type="checkbox"]').on("click",function(r){if(!t)return void(t=this);if(e.shiftKey){var a=$chkboxes.index(this),o=$chkboxes.index(t);$chkboxes.slice(Math.min(a,o),Math.max(a,o)+1).prop("checked",t.checked)}t=this})},watchTourUpdate:function(){jQuery(".wetu-status.tour-wetu-status h3 a").on("click",function(t){t.preventDefault(),jQuery(".wetu-status.tour-wetu-status").find("form").submit()})}};jQuery(document).ready(function(){WETU_IMPORTER.init()});